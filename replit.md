# Enterprise Weather Management Platform

## Overview
This platform is an enterprise weather management system with advanced multi-tenant logistics tracking and comprehensive order management capabilities. It provides robust delivery workflow management with enhanced reconciliation features, focusing on operational efficiency through detailed financial tracking, granular access controls, and sophisticated permission management.

**Business Vision & Market Potential:** The platform aims to streamline logistics and order fulfillment processes for businesses, improving efficiency and providing critical weather insights for operational planning. Its multi-tenant architecture makes it scalable for various enterprise sizes, offering a competitive edge in logistics management.

## User Preferences
- Langue pr√©f√©r√©e : Fran√ßais
- Communication : Langue simple et accessible, √©viter les d√©tails techniques
- Nettoyage : Pr√©f√®re un projet optimis√© sans fichiers inutiles

## System Architecture
The platform is built with a clear separation of concerns, utilizing a modern full-stack JavaScript architecture.

**UI/UX Decisions:**
- Frontend uses React.js with custom UI components from `shadcn/ui` and styled with Tailwind CSS for a consistent and modern aesthetic.
- The design emphasizes clean interfaces, responsive layouts for various screen sizes, and intuitive navigation.
- Color schemes prioritize readability and user comfort, with an elegant gradient and shadow design for key elements like the weather widget.

**Technical Implementations & Design Patterns:**
- **Frontend:** React.js for building interactive user interfaces. State management is handled efficiently with React Query for data fetching, caching, and synchronization.
- **Backend:** Node.js Express (ESM) provides a robust API layer. Data validation is performed using Zod schemas.
- **Database:** PostgreSQL is used as the primary data store, with Drizzle ORM facilitating interaction. Database migrations ensure schema consistency.
- **Authentication:** Secure role-based access control (RBAC) is implemented for granular permissions.
- **Multi-tenancy:** The system supports multi-tenant operations with group and permission management.
- **Module for Backup:** An integrated PostgreSQL backup manager allows manual and scheduled backups, with tracking in a `DATABASE_BACKUPS` table. **PRODUCTION FIX (Ao√ªt 2025)** : Correction critique du syst√®me de sauvegarde automatique en production - le service de sauvegarde n'√©tait pas initialis√© dans `index.production.ts`, emp√™chant la planification automatique quotidienne √† 2h00. Fix appliqu√© avec import du service et configuration Docker compl√®te (r√©pertoire `/app/backups`, variables d'environnement, volumes persistants).
- **Error Handling:** Robust error management ensures graceful degradation and informative logging, especially for production environments. API responses are logged conditionally to reduce console clutter in production.
- **Data Synchronization:** Logic is implemented to ensure data consistency between development (in-memory storage) and production (PostgreSQL) environments, particularly for order status and relationships.

**Feature Specifications:**
- **Weather Integration:** A comprehensive, modern weather interface displays detailed weather conditions sourced directly from the Visual Crossing API with French language support. Features intelligent date comparison using the same day of the week from the previous year for more relevant weather pattern analysis (e.g., Friday August 15, 2025 vs Friday August 16, 2024). Enhanced with automatic geolocation detection moved to weather settings utility page for better UX organization. Fixed critical production error by removing unused toast dependencies from weather widget (August 2025).
- **Order and Delivery Management:** Full CRUD operations for orders and deliveries, including linking orders to deliveries and managing their statuses.
- **Reconciliation:** Functionality for reconciling Bills of Lading (BL) and invoices with immediate UI updates.
- **Invoice Verification Cache:** Robust caching system for invoice verification results with automatic expiration and conflict resolution. Enhanced with unique constraint handling and graceful error management for production stability (August 2025). Fixed production SSL certificate errors and fetch timeout loops with enhanced error handling, network timeout protection, and error result caching to prevent infinite retry loops (August 2025). **MAJOR BUG FIX (August 2025)**: Resolved critical cache system failure - MemStorage was returning `undefined` for all cache lookups, preventing cache functionality entirely. Implemented working in-memory cache with Map-based storage and expiration logic. Fixed development mode to properly save verification results to cache. Added comprehensive cache operation logging for debugging. Verified complete cache workflow: miss ‚Üí save ‚Üí hit cycle working perfectly. **CRITICAL PRODUCTION FIX (August 2025)**: Fixed DatabaseStorage cache expiration bug - production was returning expired cache entries instead of checking expiration dates, causing repeated API calls despite existing cache. Added proper expiration verification and automatic cleanup of expired cache entries in PostgreSQL, matching MemStorage behavior.
- **UI Scrollbar Optimization:** Eliminated redundant vertical scrollbar on the right side of the screen while preserving necessary internal page scrolling. Implemented global CSS rules with `overflow: hidden` on html/body/root and Layout height management to prevent vertical overflow issues in production (August 2025).
- **Task Management:** Syst√®me complet de gestion des t√¢ches avec fonctionnalit√©s temporelles avanc√©es - tri intelligent (pending > priorit√© > date), dates d'√©ch√©ance avec s√©lecteur calendrier, indicateurs visuels pour t√¢ches en retard/urgentes, filtres par √©ch√©ance (aujourd'hui, cette semaine, en retard, sans √©ch√©ance), vue Kanban et liste, badges color√©s pour statut temporel. Interface optimis√©e pour suivi prioritaire des t√¢ches non valid√©es. Correction critique de l'isolation des donn√©es : chaque magasin ne voit maintenant que ses propres t√¢ches (Ao√ªt 2025). **PRODUCTION FIX (Ao√ªt 2025)** : R√©solution du probl√®me de rechargements multiples n√©cessaires pour l'administrateur - le cache des t√¢ches s'invalide maintenant automatiquement lors du changement de magasin s√©lectionn√©. **S√âLECTION DATE √âCH√âANCE FIX (Ao√ªt 2025)** : Correction du probl√®me emp√™chant la s√©lection de dates d'√©ch√©ance autres que le jour courant - suppression de la restriction `disabled` dans le calendrier, uniformisation du format d'envoi des dates, et alignement du sch√©ma Drizzle (date au lieu de timestamp) avec la structure PostgreSQL production. **DATES DE D√âPART IMPL√âMENT√âES (Ao√ªt 2025)** : Syst√®me complet de dates de d√©part avec logique de visibilit√© bas√©e sur les r√¥les - Managers/Employ√©s ne voient les t√¢ches qu'√† partir de leur date de d√©part, Admin/Directeur voient toutes les t√¢ches avec styles visuels diff√©rents pour les t√¢ches futures (fond gris, bordures pointill√©es, texte italique, badge "Future"). Interface utilisateur refonte compl√®te avec NewTaskForm.tsx pr√©sentant clairement les deux dates (üìÖ d√©part, ‚è∞ √©ch√©ance) avec r√®gles de validation et explications des r√¥les de visibilit√©.
- **Information System (Announcements):** Syst√®me d'informations complet rempla√ßant la carte commandes clients dans le dashboard - gestion d'annonces avec niveaux de priorit√© (normal, important, urgent), contr√¥le d'acc√®s bas√© sur les r√¥les (admin : CRUD complet, autres r√¥les : lecture seule), tri intelligent par priorit√© et date, filtrage par magasin pour administrateurs, interface moderne avec badges color√©s et indicateurs visuels. **PRODUCTION FIX MAJEUR (Ao√ªt 2025)** : Correction critique du probl√®me d'affichage en production PostgreSQL - fix du filtrage pour inclure annonces globales + magasin s√©lectionn√©, correction des relations d'auteur avec username au lieu d'ID, design adapt√© pour correspondre exactement aux autres cartes du dashboard. **SUPPRESSION FIX (Ao√ªt 2025)** : Correction du probl√®me de suppression en production - ajout de la logique PostgreSQL manquante dans la route DELETE, les annonces peuvent maintenant √™tre supprim√©es correctement en production. **MODAL DASHBOARD (Ao√ªt 2025)** : Ajout d'un modal automatique dans le dashboard qui affiche la derni√®re annonce cr√©√©e il y a moins de 2 jours - syst√®me de m√©morisation localStorage pour √©viter les re-affichages, interface avec priorit√©s color√©es, formatage fran√ßais des dates, filtrage par magasin pour admins. **UTILISATEUR INCONNU FIX (Ao√ªt 2025)** : Correction critique du probl√®me "utilisateur inconnu" en production - cr√©ation de la table `dashboard_messages` manquante, correction des noms de colonnes (`first_name` au lieu de `firstName`), am√©lioration de la logique de r√©cup√©ration des noms d'utilisateur avec fallback intelligent. **AFFICHAGE SIMPLIFI√â (Ao√ªt 2025)** : Suppression de l'affichage du nom de l'auteur des annonces pour simplifier l'interface - seul le nom du magasin/groupe est affich√© si applicable. **FIX MODIFICATION PRODUCTION (Ao√ªt 2025)** : Correction critique du probl√®me de modification des annonces en production - la jointure PostgreSQL utilisait incorrectement `users.id` au lieu de `users.username` pour la relation avec `createdBy`, causant des erreurs 500. Fix appliqu√© avec correction de la jointure et ajout de logs de debug dans `announcementStorage.ts`. **M√âTHODE MANQUANTE FIX (Ao√ªt 2025)** : Identification et correction de l'erreur "getAnnouncement is not a function" - ajout de la m√©thode `getAnnouncement` manquante dans l'interface `IAnnouncementStorage` et ses impl√©mentations `AnnouncementDatabaseStorage` et `AnnouncementMemoryStorage` pour r√©soudre d√©finitivement les erreurs 500 en production.
- **DLC Module Permissions:** Correction des permissions de validation DLC pour permettre aux admin, directeur et manager de valider les produits DLC. Ajout de logs de debug pour tra√ßabilit√© des validations (Ao√ªt 2025).
- **DLC UX Enhancement:** Ajout de tooltips explicatifs sur les ic√¥nes stock √©puis√© (PackageX) et restauration (RotateCcw) pour clarifier la diff√©rence entre "p√©rim√©" et "stock √©puis√©" et am√©liorer l'exp√©rience utilisateur (Ao√ªt 2025).
- **Calendrier Design Moderne (Ao√ªt 2025):** Refonte compl√®te du design du calendrier `CalendarGrid.tsx` avec interface ultra-moderne - design √©pur√© sans angles arrondis, s√©parations grises claires, weekends en fond gris, syst√®me de couleurs cod√©es (gris=livr√©, vert=livraisons, bleu=commandes, jaune=planifi√©es), couleurs pastels douces, affichage jusqu'√† 2 √©l√©ments par jour, bordures marqu√©es et ombres subtiles. **Modal d'affichage** : syst√®me modal moderne pour visualiser tous les √©l√©ments d'un jour (remplace le popover) avec cartes individuelles, zone scrollable et design coh√©rent. **SYNCHRONISATION DEV ‚Üî PRODUCTION (Ao√ªt 2025)** : Unification compl√®te du fichier CalendarGrid.tsx - m√™me code en d√©veloppement et production, MAX_VISIBLE_ITEMS forc√© √† 2, bouton "+X autres" blanc/gris uniforme, styles compatibles dev/prod. Documentation de synchronisation fournie dans `SYNC_DEV_PRODUCTION.md`. **AM√âLIORATION STYLE (Ao√ªt 2025)** : En-t√™tes de jour avec fond blanc et s√©parations plus claires (gray-100) pour un design plus √©pur√© et professionnel.
- **Harmonisation des Modales de D√©tail (Ao√ªt 2025):** Uniformisation compl√®te des modales de d√©tail entre tous les modules (commandes, livraisons, calendrier) - tous utilisent le m√™me composant `OrderDetailModal` avec ajout du champ 'type' n√©cessaire dans les handlers pour un affichage identique des informations d√©taill√©es partout.
- **User and Permission Management:** Granular access controls ensuring that users (e.g., employees) have appropriate permissions for tasks like creating customer orders.
- **Reporting:** Statistical reporting, including monthly summaries of deliveries based on `deliveredDate`.

## External Dependencies
- **API M√©t√©o:** Visual Crossing API for weather data.
- **Database:** PostgreSQL.
- **ORM:** Drizzle ORM for database interaction.
- **UI Components:** `shadcn/ui`.
- **Styling:** Tailwind CSS.